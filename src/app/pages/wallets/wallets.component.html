<section class="space-y-8">
  <header class="space-y-2">
    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Wallet Votalia (demo)</h1>
    <p class="text-sm text-gray-500 dark:text-gray-400">
      Emite y transfiere tokens <span class="font-semibold text-emerald-500">VTL</span> para alimentar los paneles de pruebas.
      Esta simulación no representa transacciones reales.
    </p>
  </header>

  @if (error()) {
    <div class="rounded-xl border border-rose-500 bg-rose-500/10 px-4 py-3 text-sm text-rose-100">
      {{ error() }}
    </div>
  }

  @if (success()) {
    <div class="rounded-xl border border-emerald-500 bg-emerald-500/10 px-4 py-3 text-sm text-emerald-100">
      {{ success() }}
    </div>
  }

  <div class="grid gap-6 lg:grid-cols-3">
    <article class="rounded-2xl border border-white/10 bg-white/70 p-5 shadow-sm dark:border-gray-800 dark:bg-gray-900">
      <h2 class="text-sm font-semibold text-gray-700 dark:text-gray-200">Oferta circulante</h2>
      <p class="mt-2 text-3xl font-bold text-emerald-500">
        {{ formatAmount(asset()?.total_supply ?? '0') }} VTL
      </p>
      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
        Máximo: {{ asset()?.max_supply ?? '∞' }} tokens
      </p>
      <button
        type="button"
        class="mt-4 inline-flex items-center gap-2 rounded-full border border-emerald-500 px-4 py-2 text-xs font-semibold text-emerald-500 transition hover:bg-emerald-500 hover:text-white"
        (click)="refreshAll()"
        [disabled]="isLoading()"
      >
        Refrescar
      </button>
    </article>

    <article class="rounded-2xl border border-white/10 bg-white/70 p-5 shadow-sm dark:border-gray-800 dark:bg-gray-900">
      <h2 class="text-sm font-semibold text-gray-700 dark:text-gray-200">Crear nueva wallet</h2>
      <form class="mt-3 space-y-3" (ngSubmit)="submitCreateWallet()">
        <div>
          <label class="block text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Actor (UUID)</label>
          <input
            type="text"
            [(ngModel)]="createForm().ownerId"
            name="ownerId"
            placeholder="Opcional"
            class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 focus:border-emerald-500 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100"
          />
        </div>
        <div>
          <label class="block text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Etiqueta</label>
          <input
            type="text"
            [(ngModel)]="createForm().label"
            name="label"
            placeholder="Wallet Votalia"
            class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 focus:border-emerald-500 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100"
          />
        </div>
        <button
          type="submit"
          class="inline-flex w-full items-center justify-center rounded-full bg-emerald-500 px-4 py-2 text-sm font-semibold text-white transition hover:bg-emerald-600 disabled:cursor-not-allowed disabled:bg-emerald-400"
          [disabled]="isLoading()"
        >
          Crear wallet
        </button>
      </form>
    </article>

    <article class="rounded-2xl border border-white/10 bg-white/70 p-5 shadow-sm dark:border-gray-800 dark:bg-gray-900">
      <h2 class="text-sm font-semibold text-gray-700 dark:text-gray-200">Mint demo</h2>
      <form class="mt-3 space-y-3" (ngSubmit)="submitMint()">
        <div>
          <label class="block text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Wallet destino</label>
          <select
            [(ngModel)]="mintForm().walletId"
            name="mintWallet"
            class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 focus:border-emerald-500 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100"
          >
            <option value="">Selecciona wallet</option>
            @for (wallet of wallets(); track wallet.id) {
              <option [value]="wallet.id">
                {{ wallet.label ?? wallet.id.slice(0, 8) }} • {{ formatAmount(wallet.balance) }} VTL
              </option>
            }
          </select>
        </div>
        <div>
          <label class="block text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Cantidad</label>
          <input
            type="number"
            min="0"
            step="0.01"
            [(ngModel)]="mintForm().amount"
            name="mintAmount"
            class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 focus:border-emerald-500 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100"
          />
        </div>
        <button
          type="submit"
          class="inline-flex w-full items-center justify-center rounded-full bg-indigo-500 px-4 py-2 text-sm font-semibold text-white transition hover:bg-indigo-600 disabled:cursor-not-allowed disabled:bg-indigo-400"
          [disabled]="isLoading()"
        >
          Emitir VTL
        </button>
      </form>
    </article>
  </div>

  <section class="grid gap-6 lg:grid-cols-2">
    <article class="rounded-2xl border border-white/10 bg-white/70 p-5 shadow-sm dark:border-gray-800 dark:bg-gray-900">
      <header class="mb-4 flex items-center justify-between">
        <h2 class="text-base font-semibold text-gray-800 dark:text-gray-100">Wallets registradas</h2>
        <span class="text-xs text-gray-500 dark:text-gray-400">{{ wallets().length }} wallets</span>
      </header>

      <div class="max-h-72 overflow-auto">
        <table class="min-w-full divide-y divide-gray-200 text-sm dark:divide-gray-700">
          <thead class="bg-gray-100 text-left dark:bg-gray-800">
            <tr>
              <th class="px-3 py-2 font-semibold text-gray-600 dark:text-gray-300">Wallet</th>
              <th class="px-3 py-2 font-semibold text-gray-600 dark:text-gray-300">Propietario</th>
              <th class="px-3 py-2 font-semibold text-gray-600 dark:text-gray-300 text-right">Balance</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 dark:divide-gray-800">
            @if (wallets().length === 0) {
              <tr>
                <td class="px-3 py-4 text-center text-xs text-gray-500 dark:text-gray-400" colspan="3">
                  Aún no hay wallets registradas.
                </td>
              </tr>
            } @else {
              @for (wallet of wallets(); track wallet.id) {
                <tr>
                  <td class="px-3 py-3 text-sm text-gray-800 dark:text-gray-100">
                    <div class="font-semibold">{{ wallet.label ?? 'Wallet demo' }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">{{ wallet.id }}</div>
                  </td>
                  <td class="px-3 py-3 text-sm text-gray-600 dark:text-gray-300">
                    {{ wallet.owner?.display_name ?? '—' }}
                  </td>
                  <td class="px-3 py-3 text-right text-sm font-semibold text-emerald-500">
                    {{ formatAmount(wallet.balance) }}
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>
    </article>

    <article class="rounded-2xl border border-white/10 bg-white/70 p-5 shadow-sm dark:border-gray-800 dark:bg-gray-900">
      <header class="mb-4 flex items-center justify-between">
        <h2 class="text-base font-semibold text-gray-800 dark:text-gray-100">Transferencia demo</h2>
      </header>

      <form class="space-y-3" (ngSubmit)="submitTransfer()">
        <div class="grid gap-3 md:grid-cols-2">
          <div>
            <label class="block text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Wallet origen</label>
            <select
              [(ngModel)]="transferForm().fromWallet"
              name="fromWallet"
              class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 focus:border-emerald-500 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100"
            >
              <option value="">Selecciona wallet</option>
              @for (wallet of wallets(); track wallet.id) {
                <option [value]="wallet.id">
                  {{ wallet.label ?? wallet.id.slice(0, 8) }} • {{ formatAmount(wallet.balance) }} VTL
                </option>
              }
            </select>
          </div>
          <div>
            <label class="block text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Wallet destino</label>
            <select
              [(ngModel)]="transferForm().toWallet"
              name="toWallet"
              class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 focus:border-emerald-500 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100"
            >
              <option value="">Selecciona wallet</option>
              @for (wallet of wallets(); track wallet.id) {
                <option [value]="wallet.id">
                  {{ wallet.label ?? wallet.id.slice(0, 8) }} • {{ formatAmount(wallet.balance) }} VTL
                </option>
              }
            </select>
          </div>
        </div>
        <div class="grid gap-3 md:grid-cols-2">
          <div>
            <label class="block text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Cantidad</label>
            <input
              type="number"
              min="0"
              step="0.01"
              [(ngModel)]="transferForm().amount"
              name="transferAmount"
              class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 focus:border-emerald-500 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100"
            />
          </div>
          <div>
            <label class="block text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Memo</label>
            <input
              type="text"
              [(ngModel)]="transferForm().memo"
              name="transferMemo"
              placeholder="Opcional"
              class="mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 focus:border-emerald-500 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100"
            />
          </div>
        </div>
        <button
          type="submit"
          class="inline-flex w-full items-center justify-center rounded-full bg-purple-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-purple-700 disabled:cursor-not-allowed disabled:bg-purple-400"
          [disabled]="isLoading()"
        >
          Transferir VTL
        </button>
      </form>
    </article>
  </section>

  <section class="rounded-2xl border border-white/10 bg-white/70 p-5 shadow-sm dark:border-gray-800 dark:bg-gray-900">
    <header class="mb-4 flex items-center justify-between">
      <h2 class="text-base font-semibold text-gray-800 dark:text-gray-100">Historial de movimientos</h2>
      <span class="text-xs text-gray-500 dark:text-gray-400">Últimas {{ transactions().length }} operaciones</span>
    </header>

    <div class="max-h-80 overflow-auto">
      <table class="min-w-full divide-y divide-gray-200 text-sm dark:divide-gray-800">
        <thead class="bg-gray-100 text-left dark:bg-gray-800">
          <tr>
            <th class="px-3 py-2 font-semibold text-gray-600 dark:text-gray-300">Fecha</th>
            <th class="px-3 py-2 font-semibold text-gray-600 dark:text-gray-300">Origen</th>
            <th class="px-3 py-2 font-semibold text-gray-600 dark:text-gray-300">Destino</th>
            <th class="px-3 py-2 font-semibold text-gray-600 dark:text-gray-300 text-right">Monto</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 dark:divide-gray-800">
          @if (transactions().length === 0) {
            <tr>
              <td class="px-3 py-4 text-center text-xs text-gray-500 dark:text-gray-400" colspan="4">
                Aún no hay movimientos registrados.
              </td>
            </tr>
          } @else {
            @for (tx of transactions(); track tx.id) {
              <tr>
                <td class="px-3 py-3 text-sm text-gray-600 dark:text-gray-300">
                  {{ tx.created_at | date:'short' }}
                </td>
                <td class="px-3 py-3 text-sm text-gray-600 dark:text-gray-300">
                  {{ tx.from?.label ?? '-' }}
                </td>
                <td class="px-3 py-3 text-sm text-gray-600 dark:text-gray-300">
                  {{ tx.to?.label ?? '-' }}
                </td>
                <td class="px-3 py-3 text-right text-sm font-semibold text-emerald-500">
                  {{ formatAmount(tx.amount) }}
                </td>
              </tr>
            }
          }
        </tbody>
      </table>
    </div>
  </section>
</section>
